{% extends "templates/layout.html" %}

{% block content %}
    {% include "auth/templates/login_modal.html" %}
    {% include "accounts/templates/quick_deposit_modal.html" %}
    {% include "templates/navbar.html" %}

    <section id="content-full-height" class="py-4 bg-light">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-md-5">
                    <form role="form" method="POST">
                        <div class="card mt-5" id="content-card">
                            <div>
                                <h4 class="card-header bg-white border-0"><strong>Session</strong></h4>
                            </div>
                            <div class="card-body bg-light mx-2 py-2" style="border-radius: 8px;">
                                <div class="row">
                                    <div class="col"><span>Please choose a category:</span>

                                        {% if categories %}
                                            {% for category in categories %}
                                                {% if category == 'FOOTBALL'%}

                                                    <div class="d-flex align-items-center px-3 rounded bg-white my-2" id="session-select-radio" onclick="selectRadioButton(this)">
                                                        <input type="radio" name="session" value="{{ category }}" required>
                                                        <span class="ms-2">{{ category }}</span><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -32 576 576" width="1em" height="1em" fill="currentColor" class="text-danger ms-2" font-size="10px">
                                                            <!--! Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc. -->
                                                            <path d="M381.2 150.3L524.9 171.5C536.8 173.2 546.8 181.6 550.6 193.1C554.4 204.7 551.3 217.3 542.7 225.9L438.5 328.1L463.1 474.7C465.1 486.7 460.2 498.9 450.2 506C440.3 513.1 427.2 514 416.5 508.3L288.1 439.8L159.8 508.3C149 514 135.9 513.1 126 506C116.1 498.9 111.1 486.7 113.2 474.7L137.8 328.1L33.58 225.9C24.97 217.3 21.91 204.7 25.69 193.1C29.46 181.6 39.43 173.2 51.42 171.5L195 150.3L259.4 17.97C264.7 6.954 275.9-.0391 288.1-.0391C300.4-.0391 311.6 6.954 316.9 17.97L381.2 150.3z"></path>
                                                        </svg>
                                                    </div>
                                                {% else %}
                                                    
                                                    <div class="d-flex align-items-center px-3 rounded bg-white my-2" id="session-select-radio" onclick="selectRadioButton(this)">
                                                        <input type="radio" name="session" value="{{ category }}">
                                                        <span class="ms-2">{{ category }}</span>
                                                    </div>

                                                {% endif %}
                
                                            {% endfor %}
                                        {% endif %}
                                        <hr style="border-top-style: dashed;" class="mb-0">
                            
                                    </div>
                                </div>

                                <div class="row font-monospace">
                                    <div class="col">
                                        <small class="text-black-50" style="font-size: 12px;">*Fee waiver applied by admin</small>
                                        <ul class="list-unstyled small">
                                            <li class="text-black-50 d-flex flex-row justify-content-between"><span>Time</span><span class="font-monospace">15 seconds</span></li>
                                            <li class="d-flex flex-row justify-content-between"><span>Amount</span><span class="font-monospace">Ksh 200</span></li>
                                            <li class="d-flex flex-row justify-content-between"><span>Fee</span><span class="font-monospace"><span style="text-decoration: line-through;">Ksh 17.50</span></span></li>
                                            <li class="d-flex flex-row justify-content-between"><span><strong>Possible payout</strong></span><span class="font-monospace"><small><strong>Ksh&nbsp;</strong></small><strong>400</strong></span></li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer bg-white border-0 mt-2">
                                <div class="row">
                                    <div class="col">
                                        <a href="{{ url_for('get_wallet') }}" class="btn btn-light d-block w-100" role="button">Account</a>
                                    </div>
                                    <div class="col">
                                        <button id="btn-preferred" class="confirm btn btn-primary d-block w-100" role="button" type="submit">
                                            <span class="animate__animated animate__flash">Play Now</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </section>
        

    {% include 'templates/footer.html' %}


    <script>

        document.querySelector(".confirm").addEventListener("click", function(event) {
            // Check if the user is logged in
            var is_logged_in = JSON.parse('{{ is_logged_in | tojson }}');
            var has_sufficient_balance = JSON.parse('{{ has_sufficient_balance | tojson }}');

            
            const login_modal = new bootstrap.Modal(document.getElementById('login'));
            const quick_deposit_modal = new bootstrap.Modal(document.getElementById('quick-deposit'));


            if (!is_logged_in) {
                // User is not logged in, prevent the default action of the href button
                event.preventDefault();

                // Show the login modal
                login_modal.show()
            } else if (!has_sufficient_balance) {
                // If user does not sufficient balance, prevent the default action of the href button
                event.preventDefault();

                // Show the insufficient balance modal
                quick_deposit_modal.show()
            }
            else {
                // User is logged in and has sufficient balance, allow the button to proceed with the HTTP GET request
                event.target.closest('form');

            }
        });

        function selectRadioButton(div) {
            var radioButton = div.querySelector('input[type="radio"]');
            radioButton.checked = true;
          }
          

    </script>

{% endblock %}